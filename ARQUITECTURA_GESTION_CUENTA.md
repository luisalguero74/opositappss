# Diagrama de Arquitectura - GestiÃ³n de Cuenta de Usuario

## ğŸ—ï¸ Arquitectura General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         OPOSITAPP PLATFORM                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     FRONTEND (Browser)        â”‚       â”‚    BACKEND (Next.js API)      â”‚
â”‚                               â”‚       â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Dashboard              â”‚  â”‚       â”‚  â”‚  NextAuth Session       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚       â”‚  â”‚  â”œâ”€ User ID             â”‚  â”‚
â”‚  â”‚  â”‚ User Menu (ğŸ‘¤)   â”‚   â”‚  â”‚â—„â”€â”€â”€â”€â”€â”¼â”€â–ºâ”‚  â”œâ”€ Email                â”‚  â”‚
â”‚  â”‚  â”‚ [Iniciales]   â–¼  â”‚   â”‚  â”‚       â”‚  â”‚  â””â”€ Role                â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚        â”‚                 â”‚  â”‚       â”‚           â”‚                   â”‚
â”‚  â”‚        â”œâ”€ Dashboard      â”‚  â”‚       â”‚           â”‚                   â”‚
â”‚  â”‚        â”œâ”€ ConfiguraciÃ³n â—„â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                   â”‚
â”‚  â”‚        â”œâ”€ Ayuda          â”‚  â”‚       â”‚         â”‚ â”‚                   â”‚
â”‚  â”‚        â””â”€ Logout         â”‚  â”‚       â”‚         â”‚ â”‚                   â”‚
â”‚  â”‚                          â”‚  â”‚       â”‚         â”‚ â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚         â”‚ â”‚                   â”‚
â”‚                               â”‚       â”‚         â”‚ â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚         â–¼ â–¼                   â”‚
â”‚  â”‚  ConfiguraciÃ³n          â”‚  â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  /dashboard/account     â”‚  â”‚       â”‚  â”‚  API: /user/account     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚       â”‚  â”‚                         â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ‘¤ Perfil         â”‚ â”‚  â”‚       â”‚  â”‚  GET â†’ Get User Data    â”‚  â”‚
â”‚  â”‚  â”‚ Nombre: [____]    â”‚ â”‚  â”‚       â”‚  â”‚  PUT â†’ Update Profile   â”‚  â”‚
â”‚  â”‚  â”‚ Email:  [____]    â”‚ â”‚  â”‚       â”‚  â”‚  PUT â†’ Change Password  â”‚  â”‚
â”‚  â”‚  â”‚                   â”‚ â”‚  â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  â”‚ [Guardar Cambios] â”‚ â”‚  â”‚       â”‚           â”‚                   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚       â”‚           â”‚                   â”‚
â”‚  â”‚                          â”‚  â”‚       â”‚           â”‚                   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚       â”‚           â–¼                   â”‚
â”‚  â”‚  â”‚ ğŸ” ContraseÃ±a     â”‚ â”‚  â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â”‚ Actual:  [****]   â”‚ â”‚  â”‚       â”‚  â”‚  Security Layer         â”‚  â”‚
â”‚  â”‚  â”‚ Nueva:   [****]   â”‚ â”‚  â”‚       â”‚  â”‚  â”œâ”€ Session Validation  â”‚  â”‚
â”‚  â”‚  â”‚ Confirm: [****]   â”‚ â”‚  â”‚       â”‚  â”‚  â”œâ”€ Input Validation    â”‚  â”‚
â”‚  â”‚  â”‚                   â”‚ â”‚  â”‚       â”‚  â”‚  â”œâ”€ Bcrypt Compare      â”‚  â”‚
â”‚  â”‚  â”‚ [Cambiar Pwd]     â”‚ â”‚  â”‚       â”‚  â”‚  â””â”€ Email Uniqueness    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚                          â”‚  â”‚       â”‚           â”‚                   â”‚
â”‚  â”‚  Validaciones:           â”‚  â”‚       â”‚           â–¼                   â”‚
â”‚  â”‚  â€¢ 8+ caracteres âœ“       â”‚  â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â€¢ Coinciden âœ“           â”‚  â”‚       â”‚  â”‚  Database (Prisma)      â”‚  â”‚
â”‚  â”‚  â€¢ No reutilizar âœ“       â”‚  â”‚       â”‚  â”‚                         â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚       â”‚  â”‚  User Table:            â”‚  â”‚
â”‚  â”‚  Errores en Tiempo Real: â”‚  â”‚       â”‚  â”‚  â”œâ”€ id                  â”‚  â”‚
â”‚  â”‚  âŒ Muy corta            â”‚  â”‚       â”‚  â”‚  â”œâ”€ email (unique)      â”‚  â”‚
â”‚  â”‚  âŒ No coinciden         â”‚  â”‚       â”‚  â”‚  â”œâ”€ password (hash)     â”‚  â”‚
â”‚  â”‚  âŒ Incorrecta           â”‚  â”‚       â”‚  â”‚  â”œâ”€ name (NEW)          â”‚  â”‚
â”‚  â”‚  âœ“ Listo                 â”‚  â”‚       â”‚  â”‚  â”œâ”€ role                â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚       â”‚  â”‚  â””â”€ timestamps          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚       â”‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Flujo de Cambio de ContraseÃ±a

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Input   â”‚
â”‚ â€¢ Actual     â”‚
â”‚ â€¢ Nueva      â”‚
â”‚ â€¢ Confirm    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend Validation          â”‚
â”‚ â€¢ 8+ characters?             â”‚
â”‚ â€¢ Match confirm?             â”‚
â”‚ â€¢ Different from old?        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ âœ“ Valid
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PUT /api/user/account        â”‚
â”‚ Headers: NextAuth Session    â”‚
â”‚ Body:                        â”‚
â”‚ {                            â”‚
â”‚   action: "changePassword"   â”‚
â”‚   currentPassword: "..."     â”‚
â”‚   newPassword: "..."         â”‚
â”‚ }                            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend Validation           â”‚
â”‚ â€¢ Auth check âœ“               â”‚
â”‚ â€¢ Length check (8-128) âœ“     â”‚
â”‚ â€¢ Not same as old âœ“          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Security Checks              â”‚
â”‚ â€¢ Get user from DB           â”‚
â”‚ â€¢ Bcrypt.compare()           â”‚
â”‚   currentPassword vs hash    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
    âœ“ Match
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hash New Password            â”‚
â”‚ â€¢ bcrypt.hash()              â”‚
â”‚ â€¢ 10 rounds                  â”‚
â”‚ â€¢ Generates new hash         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Update Database              â”‚
â”‚ UPDATE User SET              â”‚
â”‚   password = new_hash,       â”‚
â”‚   updatedAt = NOW()          â”‚
â”‚ WHERE id = user_id           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return Response              â”‚
â”‚ {                            â”‚
â”‚   success: true,             â”‚
â”‚   message: "Actualizada..."  â”‚
â”‚ }                            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend Display             â”‚
â”‚ â€¢ Clear form                 â”‚
â”‚ â€¢ Show success message       â”‚
â”‚ â€¢ Green checkmark            â”‚
â”‚ â€¢ "Logout & Verify"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ Capas de Seguridad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: Browser Level (Client-Side Validation)            â”‚
â”‚ â€¢ Required fields check                                    â”‚
â”‚ â€¢ Length validation (8+)                                  â”‚
â”‚ â€¢ Match confirmation                                      â”‚
â”‚ â€¢ Real-time feedback                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: HTTP Transport (HTTPS in Production)              â”‚
â”‚ â€¢ All requests encrypted (SSL/TLS)                        â”‚
â”‚ â€¢ Vercel HTTPS mandatory                                  â”‚
â”‚ â€¢ No password in URL/logs                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: API Level Authentication                          â”‚
â”‚ â€¢ NextAuth Session validation                             â”‚
â”‚ â€¢ JWT token verification                                  â”‚
â”‚ â€¢ User ID extraction from session                         â”‚
â”‚ â€¢ Reject if not authenticated                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 4: Input Validation (Server-Side)                    â”‚
â”‚ â€¢ Null/undefined checks                                   â”‚
â”‚ â€¢ Type checking                                           â”‚
â”‚ â€¢ Length bounds (8-128)                                   â”‚
â”‚ â€¢ Format validation                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 5: Business Logic Validation                         â”‚
â”‚ â€¢ Get user from database                                  â”‚
â”‚ â€¢ Check password exists                                   â”‚
â”‚ â€¢ Verify current password (bcrypt)                        â”‚
â”‚ â€¢ Prevent password reuse                                  â”‚
â”‚ â€¢ Ensure email uniqueness                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 6: Cryptographic Hashing                             â”‚
â”‚ â€¢ Bcrypt hashing algorithm                                â”‚
â”‚ â€¢ 10 rounds (not reversible)                              â”‚
â”‚ â€¢ Salted hashes                                           â”‚
â”‚ â€¢ Industry standard                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 7: Database Level                                    â”‚
â”‚ â€¢ Encrypted at rest (Supabase/PostgreSQL)                 â”‚
â”‚ â€¢ Backups encrypted                                       â”‚
â”‚ â€¢ Access controlled                                       â”‚
â”‚ â€¢ Audit logs available                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± Interfaz - Componentes React

```
Dashboard Component
â”‚
â””â”€â”¬â”€ UserMenu (NEW)
â”‚ â”œâ”€ useState(isOpen)
â”‚ â”œâ”€ Render Avatar + Name
â”‚ â”œâ”€ Click handler
â”‚ â””â”€ Dropdown Menu
â”‚    â”œâ”€ User Info (Read-only)
â”‚    â”œâ”€ Dashboard Link
â”‚    â”œâ”€ Settings Link â”€â”€â”€â”€â”€â”€â”
â”‚    â”œâ”€ Help Link           â”‚
â”‚    â””â”€ Logout Button       â”‚
â”‚                           â”‚
â””â”€ (Other Dashboard Sections) â”‚
                             â”‚
                             â””â”€ /dashboard/account (NEW)
                                â”‚
                                â””â”€ UserAccountSettings Component
                                   â”œâ”€ useState(activeTab)
                                   â”œâ”€ useState(formData)
                                   â”œâ”€ useState(loading)
                                   â”œâ”€ useState(message)
                                   â”‚
                                   â”œâ”€ useEffect(loadUserData)
                                   â”‚  â””â”€ GET /api/user/account
                                   â”‚
                                   â”œâ”€ Tabs:
                                   â”‚  â”œâ”€ Profile Tab
                                   â”‚  â”‚  â”œâ”€ Name Input
                                   â”‚  â”‚  â”œâ”€ Email Input
                                   â”‚  â”‚  â””â”€ Save Button
                                   â”‚  â”‚     â””â”€ PUT action: updateProfile
                                   â”‚  â”‚
                                   â”‚  â””â”€ Password Tab
                                   â”‚     â”œâ”€ Current Password Input
                                   â”‚     â”œâ”€ New Password Input
                                   â”‚     â”‚  â””â”€ Validation: 8+ chars
                                   â”‚     â”œâ”€ Confirm Password Input
                                   â”‚     â”‚  â””â”€ Match check
                                   â”‚     â”œâ”€ Show/Hide Toggle
                                   â”‚     â””â”€ Change Button
                                   â”‚        â””â”€ PUT action: changePassword
                                   â”‚
                                   â””â”€ Message Display
                                      â”œâ”€ Success (green)
                                      â””â”€ Error (red)
```

---

## ğŸ”„ Flujo de Estados (React Hooks)

```
Component Mount
â”‚
â””â”€ useEffect([], [status])
   â””â”€ if (unauthenticated) â†’ redirect to /login
   
   â””â”€ if (authenticated)
      â””â”€ loadUserData()
         â””â”€ GET /api/user/account
            â”œâ”€ setUserData(response)
            â”œâ”€ setName(response.name)
            â”œâ”€ setEmail(response.email)
            â””â”€ setLoading(false)

User Interaction: Click "Change Password"
â”‚
â””â”€ onChange(currentPassword)
   â””â”€ Update state
   
â””â”€ onChange(newPassword)
   â””â”€ Update state
   â””â”€ Re-validate (8+ chars?)
   â””â”€ Re-render with indicator
   
â””â”€ onChange(confirmPassword)
   â””â”€ Update state
   â””â”€ Match check
   â””â”€ Re-render with indicator

User Click: "Cambiar ContraseÃ±a"
â”‚
â””â”€ handleChangePassword()
   â”œâ”€ Validate all fields
   â”œâ”€ setPasswordLoading(true)
   â”‚
   â””â”€ PUT /api/user/account
      â”œâ”€ if success
      â”‚  â”œâ”€ setPasswordMessage({type: 'success'})
      â”‚  â”œâ”€ Clear form inputs
      â”‚  â””â”€ setPasswordLoading(false)
      â”‚
      â””â”€ if error
         â”œâ”€ setPasswordMessage({type: 'error'})
         â””â”€ setPasswordLoading(false)

Re-render
â”‚
â””â”€ Display message
   â”œâ”€ Success: Green box
   â””â”€ Error: Red box
```

---

## ğŸ—„ï¸ MigraciÃ³n de Base de Datos

```
Before:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Table                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id        | VARCHAR(255)   â”‚
â”‚ email     | VARCHAR(255)   â”‚
â”‚ password  | VARCHAR(255)   â”‚
â”‚ role      | VARCHAR(50)    â”‚
â”‚ createdAt | TIMESTAMP      â”‚
â”‚ updatedAt | TIMESTAMP      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After (with migration):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Table                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id        | VARCHAR(255)   â”‚
â”‚ email     | VARCHAR(255)   â”‚
â”‚ password  | VARCHAR(255)   â”‚
â”‚ name      | VARCHAR(255)   â”‚ â† NEW COLUMN
â”‚ role      | VARCHAR(50)    â”‚
â”‚ createdAt | TIMESTAMP      â”‚
â”‚ updatedAt | TIMESTAMP      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SQL Applied:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ALTER TABLE "User"                      â”‚
â”‚ ADD COLUMN "name" TEXT;                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Deployment Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Local Development                                   â”‚
â”‚ â”œâ”€ npm run build â†’ TypeScript compile & Next.js   â”‚
â”‚ â”œâ”€ npm run dev â†’ Localhost testing                 â”‚
â”‚ â””â”€ Manual testing of features                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Git Commit & Push                                   â”‚
â”‚ â”œâ”€ git add .                                       â”‚
â”‚ â”œâ”€ git commit -m "feat: gestiÃ³n de cuenta"        â”‚
â”‚ â””â”€ git push origin main                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GitHub Repository                                   â”‚
â”‚ â”œâ”€ Webhook trigger to Vercel                      â”‚
â”‚ â””â”€ Code review & merge checks                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vercel Build System                                 â”‚
â”‚ â”œâ”€ Detect changes (auto-trigger)                   â”‚
â”‚ â”œâ”€ npm run build                                   â”‚
â”‚ â”‚  â”œâ”€ TypeScript compilation                      â”‚
â”‚ â”‚  â”œâ”€ Next.js optimization                        â”‚
â”‚ â”‚  â””â”€ Vercel analytics                            â”‚
â”‚ â”œâ”€ Install dependencies                            â”‚
â”‚ â””â”€ Build artifacts generated                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database Migrations (Vercel/Production)             â”‚
â”‚ â””â”€ npx prisma migrate deploy                       â”‚
â”‚    â””â”€ ALTER TABLE "User" ADD COLUMN "name"         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Production Deploy                                   â”‚
â”‚ â”œâ”€ Deploy artifacts to Vercel Edge Network        â”‚
â”‚ â”œâ”€ Environment variables loaded                    â”‚
â”‚ â”œâ”€ Database connection tested                      â”‚
â”‚ â””â”€ Health checks passed                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Live at opositapp.site                              â”‚
â”‚ â”œâ”€ /dashboard/account accessible                  â”‚
â”‚ â”œâ”€ UserMenu functional                            â”‚
â”‚ â”œâ”€ API endpoint live                              â”‚
â”‚ â””â”€ Users can change passwords                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Request/Response Flow

```
Browser (Client)
â”‚
â”œâ”€ GET /dashboard/account
â”‚  â””â”€ Load UserAccountSettings component
â”‚     â””â”€ useEffect calls: GET /api/user/account
â”‚
â””â”€ Vercel (Server)
   â”‚
   â”œâ”€ Route Handler: /api/user/account/route.ts
   â”‚  â”‚
   â”‚  â”œâ”€ GET Request
   â”‚  â”‚  â”œâ”€ getServerSession() â†’ verify NextAuth
   â”‚  â”‚  â”œâ”€ prisma.user.findUnique()
   â”‚  â”‚  â””â”€ NextResponse.json(userData)
   â”‚  â”‚     â””â”€â”€ Return to browser
   â”‚  â”‚
   â”‚  â””â”€ PUT Request
   â”‚     â”œâ”€ Parse request body (action + data)
   â”‚     â”œâ”€ getServerSession() â†’ verify NextAuth
   â”‚     â”œâ”€ Validate inputs
   â”‚     â”‚
   â”‚     â”œâ”€ If action = "changePassword"
   â”‚     â”‚  â”œâ”€ Get user with password hash
   â”‚     â”‚  â”œâ”€ bcrypt.compare(currentPassword, hash)
   â”‚     â”‚  â”œâ”€ Hash new password with bcrypt
   â”‚     â”‚  â”œâ”€ Update database
   â”‚     â”‚  â””â”€ Return success
   â”‚     â”‚
   â”‚     â””â”€ If action = "updateProfile"
   â”‚        â”œâ”€ Check email uniqueness
   â”‚        â”œâ”€ Update database
   â”‚        â””â”€ Return updated user
   â”‚
   â””â”€ PostgreSQL Database (Supabase)
      â”œâ”€ Read/Write user data
      â”œâ”€ Enforce constraints
      â””â”€ Store encrypted data
```

---

*Diagrama tÃ©cnico completo de la soluciÃ³n de gestiÃ³n de cuenta*
